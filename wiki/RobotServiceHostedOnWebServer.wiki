#labels BotPlatform
In this page, we will introduce a new feature to you which named 'AppEngine'.

As you may not have your own server which allows you to connect to our platform directly by using our SDK, now there is another way to go, what you need is just a host on which your programs are deployed, and specify the URL in the admin page.(Use your SPID and password and sign in on http://botplatform.com, you will see this option in 'Basic Information ').

Note: If your SDK program already connects while you also provide the service for AppEngine, SDK is preferred.

= Details =

When you get ready for this, we will transer XML data through HTTP POST to the specified URL and get the HTTP response (also in XML format) to perform actions.

*We will post almost all of the 'Session Level' messages between your bot and your users to the specified URL. The XML's structure is clear and easy to understand (You may compare it with its corresponding Class file we difined in SDK), the 'type' element indicates the kind of the current message. *

_Examples of our XML data for POST:_

  * SessionOpenEvent: 
{{{
<request>
  <robotId>incetest3004@hotmail.com</robotId>
  <userId>erika_mid4@hotmail.com</userId>
  <sessionId>5257573033346114459</sessionId>
  <action type="sessionopened" />
</request>
}}}

  * SessionCloseEvent: 
{{{
<request>
  <robotId>incetest3004@hotmail.com</robotId>
  <userId>erika_mid4@hotmail.com</userId>
  <sessionId>5257573033346114459</sessionId>
  <action type="sessionclosed" />
</request>
}}}

  * TextMessage : 
{{{
<request>
  <robotId>bot@hotmail.com</robotId>
  <userId>abc@hotmail.com</userId>
  <sessionId>5257573032606033981</sessionId>
  <action type="msg">
    <fontStyle>0</fontStyle>
    <fontName>Tohoma</fontName>
    <fontColor>0</fontColor>
    <text>some plain text</text>
  </action>
</request>
}}}

  * File Message :
{{{
<request>
  <robotId>bot@hotmail.com</robotId>
  <userId>abc@hotmail.com</userId>
  <sessionId>5257573032606033981</sessionId>
  <action type="fileevent">
    <event>invite</event>
    <transferId>{B1D11ABA-8608-45A5-BD91-1F1ABC685639}</transferId>
    <size>4998</size>
    <name>wiki.txt</name>
  </action>
</request>
}}}

  * Wink Message :
{{{
<request>
  <robotId>bot@hotmail.com</robotId>
  <userId>abc@hotmail.com</userId>
  <sessionId>5257573032606033981</sessionId>
  <action type="winkevent">
    <digest>Wink digest</digest>
    <name>Wink Name</name>
    <size>30900</size>
  </action >
</request>
}}}

  * Ink Message :
{{{
<request>
  <robotId>bot@hotmail.com</robotId>
  <userId>abc@hotmail.com</userId>
  <sessionId>5257573032606033981</sessionId>
  <action type="inkmsg">ink data here</action>
</request>
}}}

  * Nudge Message :
{{{
<request>
  <robotId>bot@hotmail.com</robotId>
  <userId>abc@hotmail.com</userId>
  <sessionId>5257573032606033981</sessionId>
  <action type="nudge" />
</request>
}}}

  * Application Window Message :
{{{
<request>
  <robotId>bot@hotmail.com</robotId>
  <userId>abc@hotmail.com</userId>
  <sessionId>5257573032606033981</sessionId>
  <action type="appevent">accept</action>
</request>
}}}


*When posted, we expect the HTTP response. You may perform several actions per message(a HTTP request) if you obey the XML definition shown blow. *


_Definition of the XML structure in HTTP response:_
{{{
<response>
    <actions>
	<action type="nudge" /><!-- send nudge -->
	<action type="typing" /><!-- send typing -->
	<action type="msg"><!-- send text message -->
		<fontColor>CCCCCC</fontColor>
		<fontStyle>10</fontStyle>
		<fontName>Tahoma</fontName>
		<text>hello(1) world(2)</text>
		<emoticons>
			<entry key="(1)" value="emo1.png" />
			<entry key="(2)" value="emo2.png" />
		</emoticons>
	</action>
	<action type="wink"><!-- send specified wink -->
		<name>wink.cab</name>
		<stamp>stamp of the wink, can be empty</stamp>
	</action>
	<action type="ink"><!-- send ink message -->
		<data>base64 encoded ink data</data>
	</action>
	<action type="voice"><!-- send specified voiceclip -->
		<name>voiceclip.wav</name>
	</action>
	<action type="filecmd"><!-- when a user sends a file to your bot -->
		<cmd>accept</cmd><!-- accept or reject -->
		<transferId>tid</transferId>
		<saveUrl>http://example.saveurl.com</saveUrl><!-- for accept command only -->
	</action>
	<action type="file"><!-- send a specified file to your users -->
		<name>file.pdf</name>
	</action>
	<action type="app"><!-- open activity window -->
		<name>BotPlatform</name>
		<data>http://botplatform.com</data>
	</action>
    </actions>
</response>
}}}

_Sample code (A simple Java Servlet for AppEngine service) :
{{{
try {
	ServletInputStream is = this.request.getInputStream();
	SAXBuilder builder = new SAXBuilder();
	Document doc = null;
	try {
		doc = builder.build(is);
	} catch (JDOMException e) {
		e.printStackTrace();
		return NONE;
	} finally {
		is.close();
	}
	Element request = doc.getRootElement();
	Element action = request.getChild("action");
	String type = action.getAttributeValue("type");
	String response = null;
	if ("nudge".equals(type)) {
		response = "<response><actions><action type=\"nudge\"/></actions></response>";
	} else if ("fileevent".equals(type)) {
		if ("invite".equals(action.getChildText("event"))) {
			Random ran = new Random();
			String tid = action.getChildText("transferId");
			int ranInt = ran.nextInt(2);
			if (0 == ranInt) {
				response = "<response><actions><action type=\"filecmd\"><cmd>accept</cmd><transferId>"
						+ tid
						+ "</transferId></action></actions></response>";
			} else if (1 == ranInt) {
				response = "<response><actions><action type=\"filecmd\"><cmd>reject</cmd><transferId>"
						+ tid
						+ "</transferId></action></actions></response>";
			}
		}
	} else if ("winkevent".equals(type)) {
		response = "<response><actions><action type=\"wink\"><name>wink.dat</name><stamp>stamp could be empty</stamp></action></actions></response>";
	} else if ("inkmsg".equals(type)) {
		response = "<response><actions><action type=\"ink\"><data>ink data here(Base64 encoded)</data></action></actions></response>";
	} else if ("msg".equals(type)) {
		String content = action.getChildText("text");
		if ("voice".equals(content))
			response = "<response><actions><action type=\"voice\"><name>voiceclip.wav</name></action></actions></response>";
		else if ("app".equals(content))
			response = "<response><actions><action type=\"app\"><name>BotPlatform</name><data>http://botplatform.com</data></action></actions></response>";
		else if ("file".equals(content))
			response = "<response><actions><action type=\"file\"><name>demo.txt</name></action></actions></response>";
		else if ("typing".equals(content))
			response = "<response><actions><action type=\"typing\" /></actions></response>";
		else
			response = "<response><actions><action type=\"msg\"><fontColor>CCCCCC</fontColor><fontStyle>10</fontStyle><fontName>Tahoma</fontName>" 
+ "<text>中文hello(1)world(2)</text><emoticons><entry key=\"(1)\" value=\"emo1.png\" /><entry key=\"(2)\" value=\"emo2.png\" /></emoticons></action></actions></response>";
	} else if ("appevent".equals(type)) {
		response = "<response><actions><action type=\"msg\"><text>App Window Activity</text></action></actions></response>";
	} else if ("sessionopened".equals(type)) {
		response = "<response><actions><action type=\"msg\"><text>Session Opened</text></action></actions></response>";
	} else if ("sessionclosed".equals(type)) {
		response = "<response><actions><action type=\"msg\"><text>Session Closed</text></action></actions></response>";
	} else {
		response = "<response><actions><action type=\"msg\"><text>"
				+ type
				+ " occurs...but do nothing</text></action></actions></response>";
	}
	if (response != null)
		appendResponse(response);
} catch (IOException e) {
	e.printStackTrace();
}
return NONE;
}}}